---
products:
    new:
        limit: {{theme_settings.homepage_new_products_count}}
    featured:
        limit: {{theme_settings.homepage_featured_products_count}}
    top_sellers:
        limit: {{theme_settings.homepage_top_products_count}}
category:
    shop_by_price: true
    products:
        new:
            limit: {{theme_settings.categorypage_products_per_page}}
        limit: 50
blog:
    recent_posts:
        limit: {{theme_settings.homepage_blog_posts_count}}
gql: "query Experiment($categoryId: Int!) {
  site {
    category(entityId: $categoryId) {
      entityId
      name
      products(first: 50, sortBy: DEFAULT) {
        edges {
          node {
            name
            entityId
            addToCartUrl
            showCartAction
            productOptions(first: 50) {
              edges {
                node {
                  entityId
                  displayName
                  isRequired      
                ... on CheckboxOption {
                  checkedByDefault
                }
                ... on MultipleChoiceOption {
                  values(first: 50) {
                    edges {
                      node {
                        entityId
                        label
                        isDefault
                      }
                    }
                  }
                }
                }
              }
            }
          }
        }
      }
    }
  }
}"
---
{{inject 'productId' product.id}}
{{inject "categoryProductsPerPage" theme_settings.categorypage_products_per_page}}
{{#partial "head"}}
    {{#if pagination.category.previous}}
        <link rel="prev" href="{{{pagination.category.previous}}}">
    {{/if}}
    {{#if pagination.category.next}}
        <link rel="next" href="{{{pagination.category.next}}}">
    {{/if}}
{{/partial}}

{{#partial "page"}}

{{> components/common/breadcrumbs breadcrumbs=breadcrumbs}}
{{#if category.image}}
    {{> components/common/responsive-img
        image=category.image
        fallback_size=theme_settings.zoom_size
        lazyload=theme_settings.lazyload_mode
        class="category-header-image"
    }}
{{/if}}
{{#unless theme_settings.hide_category_page_heading }}
    <h1 class="page-heading">{{category.name}}</h1>
    {{{region name="category_below_header"}}}
{{/unless}}
{{{category.description}}}
<div class="page" style="display:flex;margin:0;" category_container>
    <main class="page-content" id="product-listing-container">
        {{> components/category/product-listing}}
    </main>
    {{#if category.faceted_search_enabled}}
        <aside class="page-sidebar" id="faceted-search-container" category_mac>
            {{> components/category/sidebar}}
        </aside>
    {{else if category.subcategories}}
        <aside class="page-sidebar" id="faceted-search-container" category_mac>
            {{> components/category/sidebar}}
        </aside>
    {{else if theme_settings.shop_by_price_visibility}}
        <aside class="page-sidebar" id="faceted-search-container" category_mac>
            {{> components/category/sidebar}}
        </aside>
    {{/if}}
</div>

{{/partial}}
{{> layout/base}}
